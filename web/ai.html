<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        {{if .debug}}
            <script src="static/js/jquery-3.3.1.min.js"></script>
            <script src="static/js/bootstrap.bundle.min.js"></script>
            <link rel="stylesheet" href="static/css/bootstrap.min.css">
        {{else}}
            <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
            <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.js"></script>
            <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
        {{end}}
        <script src="static/js/bootbox.all.min.js"></script>
        <link rel="stylesheet" href="static/css/chess.css">
    </head>
    <body>
        <div class="container">
            <div class="row mt-lg-5">
                <div class="col-lg-2">
                    <div class="col d-flex justify-content-center">
                        <div>
                            <button type="button" class="btn btn-dark btn-sm btn-block" id="myName">Me</button>
                        </div>
                        <div>
                            <button type="button" class="btn btn-light btn-sm btn-block" id="targetName">电脑</button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 d-flex justify-content-center">
                    <div class="go-board">
                    </div>
                </div>
                <div class="col-lg-2">
                    <button type="button" class="btn btn-primary btn-sm btn-block" id="game-start">开始</button>
                    <button type="button" class="btn btn-secondary btn-sm btn-block">悔棋</button>
                    <button type="button" class="btn btn-secondary btn-sm btn-block">重开</button>
                </div>
            </div>

        </div>
    </body>
<script type="application/javascript">

    let hand = {
        "nilHand": 0,
        "blackHand": 1,
        "whiteHand": 2
    };
    function ai_board(x, y){
        for (let i = 0; i < y; i++) {
            let tmp = "";
            for (let j = 0; j < x; j++) {
                tmp += `<i class="i-nomal" id="go-${j}-${i}"></i>`
                $(".go-board").append(`<i id="go-${j}-${i}"></i>`)
            }
            // $(".go-board").append(`<div>${tmp}</div>`)
            $(".go-board").append(`<br>`)
        };
    }
    ai_board(15,15);
    $(".go-board").on("click", function(e){
        if (e.target.id.startsWith("go-")){
            let arr = e.target.id.split("-");
            let x = arr[1];
            let y = arr[2];

            let msg = {
                "action": 2,
                "x": parseInt(x),
                "y": parseInt(y),
            };
            ws.send(JSON.stringify(msg));
        }
    });
    const ws = new WebSocket("ws://"+ document.location.host + "/v1/ws_ai");
    ws.onclose = function (event) {
    };
    ws.onmessage = function (event) {
        let dic = JSON.parse(event.data);
        switch (dic.action) {
            case 0:
                bootbox.alert("请开始游戏");
                break;
            case 1:
                bootbox.alert("游戏已开始,您先手");
                break;
            case 2:
                if (dic.hand === hand.blackHand){
                    $(`#go-${dic.x}-${dic.y}`).addClass("b");
                } else if (dic.hand === hand.whiteHand){
                    $(`#go-${dic.x}-${dic.y}`).addClass("w");
                }
                break;
            case 3:
                bootbox.alert("已分出胜负了！");
                break;
        }
    };
    $("#game-start").on("click", function(e){
        let msg = {
            "action": 1,
        };
        ws.send(JSON.stringify(msg));
    });
</script>
</html>